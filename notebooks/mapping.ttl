@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix ex: <http://example.com/ns#>.
@prefix map: <http://mapping.local/>.
@prefix sty: <http://purl.bioontology.org/ontology/STY/>.
@prefix sio: <http://semanticscience.org/resource/SIO_>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix ncit: <http://ncicb.nci.nih.gov/xml/owl/EVS/Thesaurus.owl#>.
@prefix roo: <http://www.cancerdata.org/roo/>.
@prefix icd: <http://purl.bioontology.org/ontology/ICD10/>.
@prefix skos: <http://www.w3.org/2008/05/skos#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.


map:basicQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT id, gender, ct as clinical_t, cn as clinical_n FROM thunderset""";
    rdfs:label """This table should contain the columns named id, gender and cT.<br/>
Every row in this table should correspond to a unique patient.<br/>
The following variables have a specific meaning:
<ul>
<li>id: unique identifier of the patient</li>
<li>gender: column identifying the patient's gender</li>
<li>clinical_t: column identifying the patient's clinical <strong>tumor</strong> stage</li>
<li>clinical_n: column identifying the patient's clinical <strong>nodal</strong> stage</li>
</ul>""";
    skos:definition "id,gender,clinical_t,clinical_n".

###########################################
# Add patient
###########################################
map:patient a rr:basicQuery;
    rr:logicalTable map:basicQuery;
    rr:subjectMap [
        rr:template "patient/{id}";
        rr:class ncit:C16960;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:column "id"; 
            rr:datatype xsd:string;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100018;
        rr:objectMap [ 
            rr:parentTriplesMap map:gender;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100008;
        rr:objectMap [ 
            rr:parentTriplesMap map:disease;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:gender a rr:TriplesMap;
    rr:logicalTable map:basicQuery;
    rr:subjectMap [
        rr:template "patient/{id}/gender";
        rr:class ncit:C28421;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "gender"; 
            rr:datatype xsd:string;
        ];
    ].


##########################################
# Disease
##########################################
map:disease a rr:TriplesMap;
    rr:logicalTable map:basicQuery;
    rr:subjectMap [
        rr:template "patient/{id}/disease";
        rr:class ncit:C20;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100243;
        rr:objectMap [ 
            rr:parentTriplesMap map:clinTnm;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

######
# Clinical TNM
######
map:clinTnm a rr:TriplesMap;
    rr:logicalTable map:basicQuery;
    rr:subjectMap [
        rr:template "patient/{id}/disease/clinTnm";
        rr:class ncit:C48881;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100244;
        rr:objectMap [ 
            rr:parentTriplesMap map:clinTnmT;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100242;
        rr:objectMap [ 
            rr:parentTriplesMap map:clinTnmN;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:clinTnmT a rr:TriplesMap;
    rr:logicalTable map:basicQuery;
    rr:subjectMap [
        rr:template "patient/{id}/disease/clinTnm/T";
        rr:class ncit:C48885;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "clinical_t"; 
            rr:datatype xsd:string;
        ];
    ].

map:clinTnmN a rr:TriplesMap;
    rr:logicalTable map:basicQuery;
    rr:subjectMap [
        rr:template "patient/{id}/disease/clinTnm/N";
        rr:class ncit:C48884;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "clinical_n"; 
            rr:datatype xsd:string;
        ];
    ].